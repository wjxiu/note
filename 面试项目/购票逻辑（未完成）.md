# 购票逻辑

1. 先过滤数据：判断车座的字母是否合法（二等座：5，一等：4，商务：3）用布隆过滤器判断用户是否存在，列车的车次是否存在，站点的数据是否存在，布隆过滤器在晚上凌晨更新数据
2. 通过策略模式选出座位
3. 生成并且保存车票，生成订单和订单项
4. 获取列车id 出发地 到达地生成这个车票会影响的车票列表
5. 将缓存的列车车票减少，并且设置影响的座位的状态为锁定状态



## 策略模式选票逻辑

策略模式的各个组件：

策略接口：定义带有参数和返回值泛型的策略方法，定义策略名字方法

策略选择类：通过实现ApplicationListener接口将初始化的所有的策略类保存到hashmap中，key是策略的名字，value是策略类，一个key只能有一个策略类，定义了通用chooseAndExecute方法

具体的选座策略方法：

根据列车id,座位类型，出发地，目的地找到可用的车厢，并且统计车厢可用座位的数量

如果所有车厢的可用座位数量小于乘客数量，报错

根据用户是否选择座位进行选择对应的方法

没有选择：`selectSeatsWithoutChose`

选择了：`selectSeatsWithChose`



`selectSeatsWithoutChose`:按照一下方法分配座位

遍历可用的车厢

如果车厢可用座位小于乘客数量跳过

查出车厢真正可用的座位，生成座位的二维数组，通过0表示没有可用，1表示不可用

对座位数组遍历统计，如果找到符合数量的连续的位置，返回座位的第一个坐标，根据坐标和人数还原座位的索引，没有返回Null.

根据座位的索引计算为08A的序号，根据座位和出发站和到达站和车厢号计算所有影响的座位，并将受影响的座位锁定，如果有一个锁定失败，还原之前锁定的，直到锁定成功，锁定成功就退出循环，根据保存的选择座位索引生成座位号，由于这个是没有选择座位的，只要顺序分配。

这个只是有连续座位的，如果全部车厢都没有连续座位，遍历之前的保存的车厢号 ---》座位个数 ，跳过座位数小于人数的车厢，使用不邻座的算法，如果同一个车厢不同位置的算法匹配失败，使用不同车厢不同座的匹配算法